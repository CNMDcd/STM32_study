/*************************
班级：电子信息工程211
作者： 文龙					所属院校：贵州黔南科技学院
电话： 18885484220			邮箱:2597443135@qq.com

当前页面：蓝牙 实现文件(bluetooth.c)
*************************/

/****
电机驱动：L298N
驱动电源接入：vcc: 5v
			stm32f407vet6 最大电压 5v

			注意，在输入电压为5v时，电机驱动无法支持鼓风机和电机最大功率运行
			所以，测试及演示时需为电机驱动外接电源(充电宝)

脉冲信号控制： GPIOC_Pin_0 GPIOC_Pin_1
			用以控制鼓风机(微型2006_5v鼓风机)
               GPIOC_Pin_2 GPIOC_Pin_3
			用以控制电机(风扇)

			//
			   
定时器：TIM5

****/

#include "bluetooth.h"

void Bluetooth_Init(void)
{
	GPIO_InitTypeDef 	GPIO_InitStructure;
	USART_InitTypeDef	USART_InitStruct;
	NVIC_InitTypeDef   NVIC_InitStructure;	
	
	//???????????GPIOA ???????
	RCC_APB2PeriphClockCmd(RCC_APB2Periph_USART1, ENABLE);
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOA, ENABLE);

	//???????????????????? GPIO_PinAFConfig ??????
	//PA9????ù????USART1
	GPIO_PinAFConfig(GPIOA, GPIO_PinSource9, GPIO_AF_USART1);	
	//PA10????ù????USART1
	GPIO_PinAFConfig(GPIOA, GPIO_PinSource10, GPIO_AF_USART1);	

	
	//GPIO ?????????????????????ù????
	//????????9
	GPIO_InitStructure.GPIO_Pin 	= GPIO_Pin_9|GPIO_Pin_10;   	//????9 10
	GPIO_InitStructure.GPIO_Mode 	= GPIO_Mode_AF;  	//??????
	GPIO_InitStructure.GPIO_Speed 	= GPIO_Speed_25MHz;
	GPIO_InitStructure.GPIO_OType 	= GPIO_OType_PP;
	GPIO_InitStructure.GPIO_PuPd 	= GPIO_PuPd_UP ;
	GPIO_Init(GPIOA, &GPIO_InitStructure); 	
	
	
	USART_InitStruct.USART_BaudRate	= my_BaudRate;		//??????
	USART_InitStruct.USART_Mode		= USART_Mode_Rx|USART_Mode_Tx; //????	
	USART_InitStruct.USART_Parity	= USART_Parity_No; //??У??λ
	USART_InitStruct.USART_StopBits	= USART_StopBits_1; //??λ
	USART_InitStruct.USART_WordLength= USART_WordLength_8b;	//?????1???
	USART_InitStruct.USART_HardwareFlowControl = USART_HardwareFlowControl_None;//???????????
	//?????????????????ò??????????????У????????
	USART_Init(USART1, &USART_InitStruct);
	
	
	
	//?????ж???????? NVIC??????ж?????????????????ж???????????h??
	NVIC_InitStructure.NVIC_IRQChannel 						= USART1_IRQn;   //?ж??????stm32f4xx.h????
	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority 	= 0x01; //????????
	NVIC_InitStructure.NVIC_IRQChannelSubPriority 			= 0x01;	//????????
	NVIC_InitStructure.NVIC_IRQChannelCmd 					= ENABLE;  //??????
	NVIC_Init(&NVIC_InitStructure);	
	
	
	//??????????ж????????????????CPU??ж???н????
	USART_ITConfig(USART1, USART_IT_RXNE, ENABLE);    
	//???????
	USART_Cmd(USART1, ENABLE);
}
